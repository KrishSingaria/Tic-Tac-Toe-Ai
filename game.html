<!doctype html>
<html lang="en-us">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    
    <title>Tic-Tac-Toe</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
  }
  #board {
    display: grid;
    grid-template-columns: 100px 100px 100px;
    grid-template-rows: 100px 100px 100px;
    width: 306px; /* A bit extra for borders */
    border: 3px solid black;
  }
  .square {
    border: 1px solid grey;
    font-size: 60px;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    -webkit-user-select: none; /* Safari */
    user-select: none; /* Prevents text highlighting when you click */
  }
  #status {
    margin-top: 20px;
    font-size: 24px;
    height: 30px; /* Prevents layout shift when text changes */
  }
  .hidden {
    display: none;
  }
</style>

  </head>
  <body>
    <h1>C++ Tic-Tac-Toe</h1>

    <div id="board">
      <div class="square" id="0"></div>
      <div class="square" id="1"></div>
      <div class="square" id="2"></div>
      <div class="square" id="3"></div>
      <div class="square" id="4"></div>
      <div class="square" id="5"></div>
      <div class="square" id="6"></div>
      <div class="square" id="7"></div>
      <div class="square" id="8"></div>
    </div>

    <h2 id="status"></h2>
    <button id="restartButton" class="hidden">Play Again?</button>
    <script type="text/javascript">
      var Module = {
        // We're keeping our onRuntimeInitialized function, as it's the entry point for our game
        onRuntimeInitialized: function() {
          console.log('Wasm is now ready! Let the game begin!');
          
          // All our custom game logic will go here.
          // For now, let's just create the game object.
          const game = new Module.Game();
          var currentPlayer = 'X';
          var gameIsOver = false;
          console.log("Initial board state from C++:", game.getBoardState());
          
          const statusDisplay = document.getElementById('status');
          const squares = document.querySelectorAll('.square');
          const restartButton = document.getElementById('restartButton');
          
          statusDisplay.textContent = `Player ${currentPlayer}'s turn`;
          restartButton.addEventListener('click', restartGame);
          squares.forEach((square,index) => {
            square.addEventListener('click',()=>{
              handlePlayerMove(index);
            });
          });  
          // Reset function 
          function restartGame() {
            game.reset();
            
            // Reset our JavaScript state
            currentPlayer = 'X';
            gameIsOver = false;

            updateBoard(); // Redraw the now-empty board
            statusDisplay.textContent = `Player ${currentPlayer}'s turn`;
            restartButton.classList.add('hidden'); // Hide the button again
          }

          // This function gets the board state from C++ and updates the HTML
          function updateBoard() {
            // Ask our C++ object for the board state string (e.g., "X_O______")
            const boardState = game.getBoardState();
            
            // Loop through each of our HTML squares
            squares.forEach((square, index) => {
              // Get the character for this square from the C++ string
              const symbol = boardState[index];
              
              // Update the square's text. If the symbol is '_', show nothing.
              square.textContent = (symbol === '_') ? '' : symbol;
            });
          }
          
          // --- GAME LOGIC HANDLER ---
          function handlePlayerMove(index) {
            const position = index + 1;
            const moveWasValid = game.makeMove(currentPlayer, position);
            
            
            if (moveWasValid && !gameIsOver) {
              updateBoard();
              
              // 1. Get the WINNER CODE (a number) from C++
              const winnerCode = game.checkWinner();
              
              // 2. DECODE the number into a proper character string
              const winner = String.fromCharCode(winnerCode);
              
              // TODO: Check the 'winner' variable.
              if (winner !== '_') {
                // made a div status display there
                // "winner(x/o) won!" when not D else "Draw"
                if (winner === 'D') {
                  // It's a draw! What do you want the text to be?
                  statusDisplay.textContent = "It's a draw!";
                } else {
                  statusDisplay.textContent = `Player ${winner} wins!`;
                }
                // Also, you should probably set your gameIsOver flag to true here
                gameIsOver = true;
                // restart button popup
                restartButton.classList.remove('hidden');
                
              } else {
                // You already wrote this part perfectly!
                currentPlayer = (currentPlayer === 'X') ? 'O' : 'X';
                
                // Don't forget to update the status for the next turn
                statusDisplay.textContent = `Player ${currentPlayer}'s turn`;
              }
            }
          }
        } 
      };
        
      </script>
    <script async type="text/javascript" src="game.js"></script>
</body>
</html>
